# Discovery of peers method used: bootnodes

services:
  node-a:
    image: hyperledger/besu:latest
    restart: on-failure
    container_name: node-a
    hostname: node-a
    volumes:
      - ./data/besu-node1:/var/lib/besu
      - ./config/nodes/1/genesis.json:/var/lib/besu/genesis.json
      - ./config/nodes/1/key:/var/lib/besu/key
    networks:
      besu-network:
        ipv4_address: 172.16.239.10
    ports:
      - "8545:8545"
      - "30303:30303"
    command:
      [
        # besu --data-path=local/1/ --genesis-file=local/genesis.json --miner-enabled --miner-coinbase=0xfe3b557e8fb62b89f4916b721be55ceb828dbd73 --rpc-http-enabled --host-whitelist="*" --rpc-http-cors-origins="*" --rpc-http-port=8545

      # Must parameters
        "--data-path=/var/lib/besu",
        "--genesis-file=/var/lib/besu/genesis.json",

        # Miner
        "--miner-enabled",
        "--miner-coinbase=0xfe3b557e8fb62b89f4916b721be55ceb828dbd73",

        # RPC protocol for requests
        "--rpc-http-enabled",
        "--host-whitelist=\"*\"",
        "--rpc-http-cors-origins=\"*\"",
        "--rpc-http-port=8545",

        "--p2p-host=172.16.239.10",
        "--p2p-port=30303",
        "--logging=TRACE"
      ]

  node-b:
    image: hyperledger/besu:latest
    restart: on-failure
    container_name: node-b
    hostname: node-b
    volumes:
      - ./data/besu-node2:/var/lib/besu
      - ./config/nodes/2/genesis.json:/var/lib/besu/genesis.json
      - ./config/nodes/2/key:/var/lib/besu/key
    networks:
      besu-network:
        ipv4_address: 172.16.239.11
    ports:
      - "8546:8545"
      - "30304:30304"
    command:
      [
        # besu --data-path=local/2/ --genesis-file=local/genesis.json --bootnodes=enode://4730f6cc03c889ba161a7172f2839d7c7df52e47eb6ba8464680c13fe6a3cab392a51a7703091ee4effc956d6c537b7d45067cbf349bed5ce7474b8547151260@127.0.0.1:30303 --p2p-port=30304

      # Must parameters
        "--data-path=/var/lib/besu",
        "--genesis-file=/var/lib/besu/genesis.json",

        # Bootnoodes
        "--bootnodes=enode://4730f6cc03c889ba161a7172f2839d7c7df52e47eb6ba8464680c13fe6a3cab392a51a7703091ee4effc956d6c537b7d45067cbf349bed5ce7474b8547151260@172.16.239.10:30303",

        # p2p port
        "--p2p-host=node-b.besu",
        "--p2p-port=30304",
        "--logging=TRACE"
      ]

networks:
  besu-network:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.239.0/24
